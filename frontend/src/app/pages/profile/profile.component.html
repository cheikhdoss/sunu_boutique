<div class="profile-container">
<<<<<<< HEAD
  <div class="profile-header">
    <h1>Mon Profil</h1>
    <p>Gérez vos informations personnelles, adresses et consultez votre historique de commandes</p>
  </div>

  <!-- Section de présentation de l'utilisateur -->
  <mat-card class="user-presentation-card" *ngIf="currentUser">
    <div class="user-presentation">
      <div class="user-avatar">
        <img *ngIf="avatarPreview || currentUser.avatar" 
             [src]="avatarPreview || currentUser.avatar" 
             alt="Avatar" 
             class="user-avatar-image">
        <div *ngIf="!avatarPreview && !currentUser.avatar" class="user-avatar-placeholder">
          <mat-icon>person</mat-icon>
        </div>
      </div>
      <div class="user-info">
        <h2 class="user-name">{{ currentUser.name }}</h2>
        <p class="user-email">{{ currentUser.email }}</p>
        <p class="user-phone" *ngIf="currentUser.phone">
          <mat-icon>phone</mat-icon>
          {{ currentUser.phone }}
        </p>
      </div>
    </div>
  </mat-card>

  <mat-card class="profile-card">
    <mat-tab-group>
      <!-- Onglet Informations personnelles -->
      <mat-tab label="Informations personnelles">
        <div class="tab-content">
          <!-- Section Avatar -->
          <div class="avatar-section">
            <h3>Photo de profil</h3>
            <div class="avatar-container">
              <div class="avatar-preview">
                <img *ngIf="avatarPreview" [src]="avatarPreview" alt="Avatar" class="avatar-image">
                <div *ngIf="!avatarPreview" class="avatar-placeholder">
                  <mat-icon>person</mat-icon>
                </div>
              </div>
              <div class="avatar-actions">
                <input type="file" #avatarInput (change)="onAvatarSelected($event)" 
                       accept="image/*" style="display: none;">
                <button mat-raised-button color="primary" (click)="avatarInput.click()">
                  <mat-icon>photo_camera</mat-icon>
                  Choisir une photo
                </button>
                <button mat-button color="primary" (click)="uploadAvatar()" 
                        [disabled]="!avatarFile || isLoading" *ngIf="avatarFile">
                  <mat-icon>upload</mat-icon>
                  Uploader
                </button>
                <button mat-button color="warn" (click)="deleteAvatar()" 
                        *ngIf="avatarPreview && !avatarFile">
                  <mat-icon>delete</mat-icon>
                  Supprimer
                </button>
              </div>
            </div>
          </div>

          <mat-divider></mat-divider>

          <!-- Formulaire profil -->
          <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nom complet</mat-label>
                <input matInput formControlName="name" placeholder="Votre nom complet">
                <mat-error>{{ getErrorMessage(profileForm, 'name') }}</mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Adresse email</mat-label>
                <input matInput type="email" formControlName="email" placeholder="votre@email.com">
                <mat-error>{{ getErrorMessage(profileForm, 'email') }}</mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Téléphone</mat-label>
                <input matInput formControlName="phone" placeholder="+33 1 23 45 67 89">
                <mat-error>{{ getErrorMessage(profileForm, 'phone') }}</mat-error>
              </mat-form-field>
            </div>

            <div class="form-actions">
              <button mat-raised-button color="primary" type="submit" 
                      [disabled]="profileForm.invalid || isLoading">
                <mat-icon *ngIf="isLoading">hourglass_empty</mat-icon>
                <mat-icon *ngIf="!isLoading">save</mat-icon>
                {{ isLoading ? 'Mise à jour...' : 'Mettre à jour' }}
              </button>
            </div>
          </form>
        </div>
      </mat-tab>

      <!-- Onglet Adresses de livraison -->
      <mat-tab label="Adresses de livraison">
        <div class="tab-content">
          <div class="addresses-header">
            <h3>Mes adresses de livraison</h3>
            <button mat-raised-button color="primary" (click)="isAddingAddress = true" 
                    *ngIf="!isAddingAddress">
              <mat-icon>add</mat-icon>
              Ajouter une adresse
            </button>
          </div>

          <!-- Formulaire d'ajout d'adresse -->
          <mat-card class="address-form-card" *ngIf="isAddingAddress">
            <mat-card-header>
              <mat-card-title>Nouvelle adresse</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <form [formGroup]="addressForm" (ngSubmit)="addAddress()">
                <div class="form-row">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Libellé de l'adresse</mat-label>
                    <input matInput formControlName="label" placeholder="Ex: Domicile, Bureau">
                    <mat-error>{{ getErrorMessage(addressForm, 'label') }}</mat-error>
                  </mat-form-field>
                </div>

                <div class="form-row two-columns">
                  <mat-form-field appearance="outline">
                    <mat-label>Prénom</mat-label>
                    <input matInput formControlName="first_name">
                    <mat-error>{{ getErrorMessage(addressForm, 'first_name') }}</mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline">
                    <mat-label>Nom</mat-label>
                    <input matInput formControlName="last_name">
                    <mat-error>{{ getErrorMessage(addressForm, 'last_name') }}</mat-error>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Adresse complète</mat-label>
                    <input matInput formControlName="address" placeholder="Numéro et nom de rue">
                    <mat-error>{{ getErrorMessage(addressForm, 'address') }}</mat-error>
                  </mat-form-field>
                </div>

                <div class="form-row two-columns">
                  <mat-form-field appearance="outline">
                    <mat-label>Ville</mat-label>
                    <input matInput formControlName="city">
                    <mat-error>{{ getErrorMessage(addressForm, 'city') }}</mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline">
                    <mat-label>Code postal</mat-label>
                    <input matInput formControlName="postal_code" placeholder="75001">
                    <mat-error>{{ getErrorMessage(addressForm, 'postal_code') }}</mat-error>
                  </mat-form-field>
                </div>

                <div class="form-row two-columns">
                  <mat-form-field appearance="outline">
                    <mat-label>Pays</mat-label>
                    <mat-select formControlName="country">
                      <mat-option value="France">France</mat-option>
                      <mat-option value="Belgique">Belgique</mat-option>
                      <mat-option value="Suisse">Suisse</mat-option>
                    </mat-select>
                  </mat-form-field>
                  <mat-form-field appearance="outline">
                    <mat-label>Téléphone</mat-label>
                    <input matInput formControlName="phone" placeholder="+33 1 23 45 67 89">
                    <mat-error>{{ getErrorMessage(addressForm, 'phone') }}</mat-error>
                  </mat-form-field>
                </div>

                <div class="form-actions">
                  <button mat-button type="button" (click)="isAddingAddress = false; addressForm.reset()">
                    Annuler
                  </button>
                  <button mat-raised-button color="primary" type="submit" 
                          [disabled]="addressForm.invalid">
                    <mat-icon>save</mat-icon>
                    Enregistrer
                  </button>
                </div>
              </form>
            </mat-card-content>
          </mat-card>

          <!-- Liste des adresses -->
          <div class="addresses-list" *ngIf="deliveryAddresses.length > 0">
            <mat-card class="address-card" *ngFor="let address of deliveryAddresses">
              <mat-card-header>
                <div class="address-header">
                  <div class="address-label">
                    <h4>{{ address.label }}</h4>
                    <mat-chip *ngIf="address.is_default" color="primary" selected>
                      Par défaut
                    </mat-chip>
                  </div>
                  <div class="address-actions">
                    <button mat-icon-button (click)="editAddress(address)">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="deleteAddress(address.id!)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </div>
              </mat-card-header>
              <mat-card-content>
                <div class="address-details">
                  <p><strong>{{ address.first_name }} {{ address.last_name }}</strong></p>
                  <p>{{ address.address }}</p>
                  <p>{{ address.postal_code }} {{ address.city }}</p>
                  <p>{{ address.country }}</p>
                  <p><mat-icon>phone</mat-icon> {{ address.phone }}</p>
                </div>
              </mat-card-content>
              <mat-card-actions *ngIf="!address.is_default">
                <button mat-button color="primary" (click)="setDefaultAddress(address.id!)">
                  <mat-icon>star</mat-icon>
                  Définir par défaut
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <!-- Onglet Historique des commandes -->
      <mat-tab label="Historique des commandes">
        <div class="tab-content">
          <div class="orders-header">
            <h3>Mes commandes</h3>
            <p>Consultez l'état de vos commandes et téléchargez vos factures</p>
          </div>

          <div class="orders-list" *ngIf="orderHistory.length > 0; else noOrdersTemplate">
            <mat-expansion-panel class="order-panel" *ngFor="let order of orderHistory">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="order-summary">
                    <div class="order-info">
                      <strong>{{ order.order_number }}</strong>
                      <span class="order-date">{{ order.date | date:'dd/MM/yyyy' }}</span>
                    </div>
                    <div class="order-status">
                      <mat-chip [color]="getStatusColor(order.status)" selected>
                        {{ getStatusLabel(order.status) }}
                      </mat-chip>
                      <span class="order-total">{{ order.total | currency:'EUR':'symbol':'1.2-2' }}</span>
                    </div>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>

              <div class="order-details">
                <!-- Informations de paiement -->
                <div class="payment-info">
                  <h4>Informations de paiement</h4>
                  <div class="payment-details">
                    <div class="payment-item">
                      <span class="label">Mode de paiement:</span>
                      <span class="value">{{ getPaymentMethodLabel(order.payment_method) }}</span>
                    </div>
                    <div class="payment-item">
                      <span class="label">Statut du paiement:</span>
                      <mat-chip [color]="order.payment_status === 'paye' ? 'primary' : 'warn'" selected>
                        {{ getPaymentStatusLabel(order.payment_status) }}
                      </mat-chip>
                    </div>
                  </div>
                </div>

                <mat-divider></mat-divider>

                <!-- Articles commandés -->
                <div class="order-items">
                  <h4>Articles commandés</h4>
                  <div class="item" *ngFor="let item of order.items">
                    <div class="item-info">
                      <span class="item-name">{{ item.name }}</span>
                      <span class="item-details">
                        {{ item.quantity }} × {{ item.unit_price | currency:'EUR':'symbol':'1.2-2' }}
                      </span>
                    </div>
                    <div class="item-total">
                      {{ item.total_price | currency:'EUR':'symbol':'1.2-2' }}
                    </div>
                  </div>
                  <div class="order-total-line">
                    <strong>Total: {{ order.total | currency:'EUR':'symbol':'1.2-2' }}</strong>
                  </div>
                </div>

                <mat-divider></mat-divider>

                <!-- Adresse de livraison -->
                <div class="delivery-info">
                  <h4>Adresse de livraison</h4>
                  <div class="delivery-address">
                    <p><strong>{{ order.delivery_address.first_name }} {{ order.delivery_address.last_name }}</strong></p>
                    <p>{{ order.delivery_address.address }}</p>
                    <p>{{ order.delivery_address.postal_code }} {{ order.delivery_address.city }}</p>
                    <p>{{ order.delivery_address.country }}</p>
                  </div>
                </div>

                <!-- Actions -->
                <div class="order-actions">
                  <button mat-button color="primary" (click)="downloadInvoice(order)" 
                          *ngIf="order.status === 'livree' || order.invoice_url">
                    <mat-icon>download</mat-icon>
                    Télécharger la facture
                  </button>
                  <button mat-button (click)="reorderItems(order)" 
                          *ngIf="order.status === 'livree'">
                    <mat-icon>refresh</mat-icon>
                    Recommander
                  </button>
                  <button mat-button color="warn" (click)="cancelOrder(order)" 
                          *ngIf="order.status === 'en_attente'">
                    <mat-icon>cancel</mat-icon>
                    Annuler la commande
                  </button>
                </div>
              </div>
            </mat-expansion-panel>
          </div>

          <ng-template #noOrdersTemplate>
            <div class="no-orders">
              <mat-icon class="no-orders-icon">shopping_bag</mat-icon>
              <h3>Aucune commande</h3>
              <p>Vous n'avez pas encore passé de commande.</p>
              <button mat-raised-button color="primary" routerLink="/">
                <mat-icon>shopping_cart</mat-icon>
                Commencer mes achats
              </button>
            </div>
          </ng-template>
        </div>
      </mat-tab>

      <!-- Onglet Mot de passe -->
      <mat-tab label="Mot de passe">
        <div class="tab-content">
          <form [formGroup]="passwordForm" (ngSubmit)="updatePassword()">
            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Mot de passe actuel</mat-label>
                <input matInput type="password" formControlName="currentPassword">
                <mat-error>{{ getErrorMessage(passwordForm, 'currentPassword') }}</mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nouveau mot de passe</mat-label>
                <input matInput type="password" formControlName="newPassword">
                <mat-error>{{ getErrorMessage(passwordForm, 'newPassword') }}</mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Confirmer le nouveau mot de passe</mat-label>
                <input matInput type="password" formControlName="confirmPassword">
                <mat-error>{{ getErrorMessage(passwordForm, 'confirmPassword') }}</mat-error>
              </mat-form-field>
            </div>

            <div class="form-actions">
              <button mat-raised-button color="primary" type="submit" 
                      [disabled]="passwordForm.invalid || isLoading">
                <mat-icon *ngIf="isLoading">hourglass_empty</mat-icon>
                <mat-icon *ngIf="!isLoading">lock</mat-icon>
                {{ isLoading ? 'Mise à jour...' : 'Changer le mot de passe' }}
              </button>
            </div>
          </form>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
=======
  <!-- Header simplifié avec avatar éditable -->
  <div class="profile-header">
    <div class="user-avatar-section">
      <div class="user-avatar" [matMenuTriggerFor]="avatarMenu">
        <img *ngIf="userProfile?.avatar" [src]="userProfile?.avatar" [alt]="userProfile?.name" class="avatar-image">
        <mat-icon *ngIf="!userProfile?.avatar" class="avatar-icon">account_circle</mat-icon>
        <div class="avatar-overlay">
          <mat-icon>camera_alt</mat-icon>
        </div>
      </div>
      
      <mat-menu #avatarMenu="matMenu" class="avatar-menu">
        <button mat-menu-item (click)="openAvatarUpload()">
          <mat-icon>add_a_photo</mat-icon>
          <span>Changer la photo</span>
        </button>
        <button mat-menu-item (click)="removeAvatar()" *ngIf="userProfile?.avatar">
          <mat-icon>delete</mat-icon>
          <span>Supprimer la photo</span>
        </button>
      </mat-menu>
      
      <input #avatarInput type="file" accept="image/*" (change)="onAvatarChange($event)" style="display: none;">
    </div>
    
    <div class="user-info" *ngIf="userProfile">
      <h1 class="user-name">{{ userProfile.name }}</h1>
      <p class="user-email">{{ userProfile.email }}</p>
      <p class="member-since">Membre depuis {{ userProfile.created_at | date:'MMMM yyyy':'':'fr' }}</p>
    </div>
  </div>

  <!-- Statistiques simplifiées -->
  <div class="stats-section" *ngIf="userStats">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <mat-icon>shopping_bag</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ animatedStats.total_orders }}</div>
          <div class="stat-label">Commandes</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <mat-icon>payments</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ animatedStats.total_spent | currency:'XOF':'symbol':'1.0-0' }}</div>
          <div class="stat-label">Total dépensé</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <mat-icon>pending</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ animatedStats.pending_orders }}</div>
          <div class="stat-label">En attente</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <mat-icon>check_circle</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ userStats.completed_orders || 0 }}</div>
          <div class="stat-label">Terminées</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Onglets simplifiés -->
  <mat-tab-group [(selectedIndex)]="selectedTabIndex" class="profile-tabs">
    
    <!-- Onglet Profil -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>person</mat-icon>
        <span>Profil</span>
      </ng-template>
      <div class="tab-content">
        <mat-card class="form-card">
          <mat-card-header>
            <mat-card-title>Informations personnelles</mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nom complet</mat-label>
                <input matInput formControlName="name" required>
                <mat-error>{{ getErrorMessage(profileForm, 'name') }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Email</mat-label>
                <input matInput type="email" formControlName="email" required>
                <mat-error>{{ getErrorMessage(profileForm, 'email') }}</mat-error>
              </mat-form-field>

              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Téléphone</mat-label>
                  <input matInput type="tel" formControlName="phone">
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Genre</mat-label>
                  <mat-select formControlName="gender">
                    <mat-option value="male">Homme</mat-option>
                    <mat-option value="female">Femme</mat-option>
                    <mat-option value="other">Autre</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Date de naissance</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="date_of_birth">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>

              <div class="form-actions">
                <button mat-raised-button color="primary" type="submit" 
                        [disabled]="profileForm.invalid || isLoadingProfile">
                  {{ isLoadingProfile ? 'Mise à jour...' : 'Mettre à jour' }}
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Onglet Commandes -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>shopping_bag</mat-icon>
        <span>Commandes</span>
        <mat-chip class="tab-badge" *ngIf="userStats?.pending_orders">{{ userStats.pending_orders }}</mat-chip>
      </ng-template>
      <div class="tab-content">
        <!-- Filtres simplifiés -->
        <div class="orders-filters">
          <mat-form-field appearance="outline">
            <mat-label>Rechercher</mat-label>
            <input matInput [(ngModel)]="orderSearchTerm" (input)="filterOrders()" placeholder="Numéro de commande...">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Statut</mat-label>
            <mat-select [(ngModel)]="selectedOrderStatus" (selectionChange)="filterOrders()">
              <mat-option value="">Tous</mat-option>
              <mat-option value="pending">En attente</mat-option>
              <mat-option value="processing">En traitement</mat-option>
              <mat-option value="shipped">Expédiée</mat-option>
              <mat-option value="delivered">Livrée</mat-option>
              <mat-option value="cancelled">Annulée</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Liste des commandes -->
        <div class="orders-list" *ngIf="filteredOrders.length > 0; else noOrders">
          <mat-card *ngFor="let order of filteredOrders; trackBy: trackByOrderId" class="order-card">
            <mat-card-header>
              <div class="order-header">
                <div class="order-info">
                  <h3>{{ order.order_number }}</h3>
                  <p class="order-date">{{ order.created_at | date:'dd/MM/yyyy' }}</p>
                </div>
                <div class="order-status">
                  <mat-chip [style.background-color]="getStatusColor(order.status)" class="status-chip">
                    {{ getStatusLabel(order.status) }}
                  </mat-chip>
                  <span class="order-total">{{ order.total | currency:'XOF':'symbol':'1.0-0' }}</span>
                </div>
              </div>
            </mat-card-header>
            
            <mat-card-content>
              <div class="order-summary">
                <span>{{ order.items?.length || 0 }} article(s)</span>
                <span>{{ order.payment_method === 'online' ? 'En ligne' : 'À la livraison' }}</span>
              </div>
            </mat-card-content>
            
            <mat-card-actions>
              <button mat-button (click)="viewOrderDetails(order.id)">
                <mat-icon>visibility</mat-icon>
                Détails
              </button>
              <button mat-button *ngIf="order.status === 'delivered'" (click)="downloadInvoice(order.id)">
                <mat-icon>download</mat-icon>
                Facture
              </button>
            </mat-card-actions>
          </mat-card>
        </div>

        <ng-template #noOrders>
          <div class="empty-state">
            <mat-icon class="empty-icon">shopping_bag</mat-icon>
            <h3>Aucune commande</h3>
            <p>Vous n'avez pas encore passé de commande</p>
          </div>
        </ng-template>
      </div>
    </mat-tab>

    <!-- Onglet Adresses -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>location_on</mat-icon>
        <span>Adresses</span>
        <mat-chip class="tab-badge" *ngIf="addresses.length">{{ addresses.length }}</mat-chip>
      </ng-template>
      <div class="tab-content">
        <div class="section-header">
          <h3>Mes adresses</h3>
          <button mat-raised-button color="primary" (click)="addNewAddress()">
            <mat-icon>add</mat-icon>
            Ajouter
          </button>
        </div>

        <div class="addresses-grid" *ngIf="addresses.length > 0; else noAddresses">
          <mat-card *ngFor="let address of addresses" class="address-card" [class.default-address]="address.is_default">
            <mat-card-header>
              <mat-card-title>
                {{ address.type === 'billing' ? 'Facturation' : 'Livraison' }}
                <mat-chip *ngIf="address.is_default" color="primary">Par défaut</mat-chip>
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="address-details">
                <p><strong>{{ address.first_name }} {{ address.last_name }}</strong></p>
                <p>{{ address.address_line_1 }}</p>
                <p>{{ address.postal_code }} {{ address.city }}</p>
                <p>{{ address.country }}</p>
                <p *ngIf="address.phone">{{ address.phone }}</p>
              </div>
            </mat-card-content>
            
            <mat-card-actions>
              <button mat-button (click)="editAddress(address.id)">
                <mat-icon>edit</mat-icon>
                Modifier
              </button>
              <button mat-button *ngIf="!address.is_default" (click)="setDefaultAddress(address.id)">
                <mat-icon>star_border</mat-icon>
                Par défaut
              </button>
              <button mat-button color="warn" (click)="deleteAddress(address.id)">
                <mat-icon>delete</mat-icon>
                Supprimer
              </button>
            </mat-card-actions>
          </mat-card>
        </div>

        <ng-template #noAddresses>
          <div class="empty-state">
            <mat-icon class="empty-icon">location_off</mat-icon>
            <h3>Aucune adresse</h3>
            <p>Ajoutez une adresse pour faciliter vos commandes</p>
          </div>
        </ng-template>
      </div>
    </mat-tab>

    <!-- Onglet Favoris -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>favorite</mat-icon>
        <span>Favoris</span>
        <mat-chip class="tab-badge" *ngIf="favoriteProducts.length">{{ favoriteProducts.length }}</mat-chip>
      </ng-template>
      <div class="tab-content">
        <div class="section-header">
          <h3>Mes favoris</h3>
          <button mat-stroked-button (click)="clearAllFavorites()" *ngIf="favoriteProducts.length">
            <mat-icon>clear_all</mat-icon>
            Tout effacer
          </button>
        </div>

        <div class="favorites-grid" *ngIf="favoriteProducts.length > 0; else noFavorites">
          <mat-card *ngFor="let product of favoriteProducts" class="favorite-card">
            <div class="favorite-image">
              <img [src]="product.image" [alt]="product.name">
              <button mat-icon-button class="remove-favorite" (click)="removeFromFavorites(product.id)">
                <mat-icon>favorite</mat-icon>
              </button>
            </div>
            
            <mat-card-content>
              <h4>{{ product.name }}</h4>
              <div class="product-price">{{ product.price | currency:'XOF':'symbol':'1.0-0' }}</div>
              <div class="product-availability" [class.in-stock]="product.stock > 0">
                {{ product.stock > 0 ? 'En stock' : 'Rupture de stock' }}
              </div>
            </mat-card-content>
            
            <mat-card-actions>
              <button mat-raised-button color="primary" [disabled]="product.stock === 0" (click)="addToCart(product)">
                Ajouter au panier
              </button>
            </mat-card-actions>
          </mat-card>
        </div>

        <ng-template #noFavorites>
          <div class="empty-state">
            <mat-icon class="empty-icon">favorite_border</mat-icon>
            <h3>Aucun favori</h3>
            <p>Ajoutez des produits à vos favoris</p>
          </div>
        </ng-template>
      </div>
    </mat-tab>

    <!-- Onglet Sécurité -->
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>security</mat-icon>
        <span>Sécurité</span>
      </ng-template>
      <div class="tab-content">
        <mat-card class="form-card">
          <mat-card-header>
            <mat-card-title>Changer le mot de passe</mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Mot de passe actuel</mat-label>
                <input matInput type="password" formControlName="current_password" required>
                <mat-error>{{ getErrorMessage(passwordForm, 'current_password') }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nouveau mot de passe</mat-label>
                <input matInput type="password" formControlName="new_password" required>
                <mat-error>{{ getErrorMessage(passwordForm, 'new_password') }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Confirmer le nouveau mot de passe</mat-label>
                <input matInput type="password" formControlName="new_password_confirmation" required>
                <mat-error>{{ getErrorMessage(passwordForm, 'new_password_confirmation') }}</mat-error>
              </mat-form-field>

              <div class="form-actions">
                <button mat-raised-button color="primary" type="submit" 
                        [disabled]="passwordForm.invalid || isLoadingPassword">
                  {{ isLoadingPassword ? 'Modification...' : 'Changer le mot de passe' }}
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>

        <!-- Zone de danger -->
        <mat-card class="danger-card">
          <mat-card-header>
            <mat-card-title>Supprimer le compte</mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            <p>Cette action est irréversible. Toutes vos données seront perdues.</p>
            <button mat-raised-button color="warn" (click)="onDeleteAccount()">
              Supprimer mon compte
            </button>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

  </mat-tab-group>
>>>>>>> origin/main
</div>